{% extends 'base.html'%}
{% load static %}
{% block content %}

  <!-- ======= Hero Section ======= -->
  <section id="hero" class="d-flex align-items-center">
    <div class="container text-center" data-aos="zoom-out" data-aos-delay="100">
      <h1>Nurobod tumani 1-son politexnikumi</h1>
     <br>
      <!-- <h1>SamDU Registrator ofisi <span>Online Navbat</span></h1>
      <h2>tizimidan quyidagi <span class="text-primary">samduinfo_bot </span> bot orqali ro'yxatdan o'ting</h2>
      <br> -->
      
      
      
      <div class="">
        <div class="task-info">
            <h1><span class="task-title" id="task_title"></span> <span class="text-primary-emphasis" id="task_queue"></span></h1>
        </div>
    </div>
      

        
      </div>
      
      <!-- <div class="d-flex">
        <a href="#about" class="btn-get-started scrollto">Get Started</a>
        <a href="https://www.youtube.com/watch?v=jDDaplaOz7Q" class="glightbox btn-watch-video"><i class="bi bi-play-circle"></i><span>Watch Video</span></a>
      </div> -->
    </div>
    
  </section><!-- End Hero -->










  <!-- ======= Featured Services Section ======= -->
  <section id="featured-services" class="featured-services">
    <div class="container" data-aos="fade-up">
      <div class="row">
        <p class="text-center display-4">
          <span class="text-info-emphasis">Nurobod tumani kasb hunar maktabi yangiliklari</span>
        </p>
        <div class="row g-4">
          {% for news in news_list %}
          <div class="col-md-4">
            <div class="card h-100 shadow-sm border-0">
              {% if news.image %}
                <img src="{{ news.image.url }}" class="card-img-top rounded-top" alt="{{ news.title }}" style="height: 180px; object-fit: cover;">
              {% else %}
                <div style="height:180px; background:#f0f0f0; display:flex; align-items:center; justify-content:center;" class="card-img-top rounded-top">
                  <span class="text-muted">Rasm yoâ€˜q</span>
                </div>
              {% endif %}
              <div class="card-body d-flex flex-column">
                <h5 class="card-title">{{ news.title }}</h5>
                <p class="card-text text-muted small">{{ news.created_at|date:"d.m.Y" }}</p>
                <p class="card-text flex-grow-1">{{ news.content|truncatewords:20 }}</p>
                <a href="{% url 'news-detail' news.id %}" class="btn btn-outline-primary mt-auto">Batafsil</a>
              </div>
            </div>
          </div>
          {% empty %}
          <div class="col-12">
            <div class="alert alert-info text-center">Hozircha yangiliklar mavjud emas.</div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
    
  </section><!-- End Featured Services Section -->






    <section id="about" class="about section-bg">
      <div class="container" data-aos="fade-up">

        <div class="row">
            <p class="text-center display-4">
                <span class="text-primary-emphasis">Nurobod kasb hunar maktabi haqida</span>
            </p>
            <p class="text-center fs-5">
                Lorem, ipsum dolor sit amet consectetur adipisicing elit. Quae consequuntur asperiores sit hic similique? Nam a molestiae accusantium maiores nihil perspiciatis odio, quis ratione. Aspernatur nihil accusamus optio pariatur excepturi impedit dolor quae fugit assumenda neque enim tempora eos voluptatum ipsam et illum, quis ab voluptatibus culpa beatae quaerat repellat. Fugiat, tenetur voluptatibus? Dicta voluptas tempore magni, fugit obcaecati odit asperiores architecto praesentium fuga explicabo illo distinctio ad ab! Ab minus magni, ipsum, debitis magnam, corrupti ea quas obcaecati dicta eum mollitia explicabo repellendus illum veniam quibusdam perspiciatis. Consequuntur doloribus vel aperiam accusamus autem dolorum temporibus, saepe nostrum deleniti iusto?
            </p>
        </div>

      </div>
    </section>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            $("form").submit(function (event) {
                event.preventDefault();  // Formani standart joâ€˜natishni toâ€˜xtatamiz
    
                let buttonName = $(document.activeElement).attr("name");  // Bosilgan button nomini olish

                let formData = {
                    service: buttonName,  // Bosilgan tugma nomini yuboramiz
                    csrfmiddlewaretoken: $("input[name=csrfmiddlewaretoken]").val() // CSRF tokenni qoâ€˜shamiz
                };  // Bosilgan tugma nomini olish
                // let formData = {
                //     firstname: $("#firstName").val(),
                //     lastname: $("#lastName").val(),
                //     phone: $("#phoneNumber").val(),
                //     service: $("#exampleFormControlSelect1").val(),
                //     csrfmiddlewaretoken: $("input[name=csrfmiddlewaretoken]").val() // CSRF tokenni qoâ€˜shamiz
                // };
    
                $.ajax({
                    type: "POST",
                    url: "#",  
                    data: formData,
                    success: function (response) {
                      console.log(response)
                      $('#response_form').empty(); 
                      $('#response_form').append(`<span class="text-success">${response.message}</span>`);  

                      $("form")[0].reset();  

                      // Rasmni chiqarish
                      if (response.image) {
                          $("#generatedImage")
                              .attr("src", response.image)
                              .removeClass("d-none") // Agar Bootstrap `d-none` classi boâ€˜lsa, olib tashlaymiz
                              .css({ display: "block", width: "auto", height: "auto" }); // To'g'ri oâ€˜lchamda chiqarish
                      }

                      // 5 soniyadan keyin xabar va rasmni oâ€˜chirish
                      setTimeout(function () {
                          $('#response_form').fadeOut('slow', function () {
                              $(this).empty().css("display", "block"); // Divni tozalab, yana koâ€˜rinadigan qilamiz
                          });

                          $("#generatedImage").fadeOut('slow', function () {
                              $(this).attr("src", "")
                                  .addClass("d-none") // Bootstrap orqali butunlay yashiramiz
                                  .removeAttr("style"); // Barcha inline stillarni olib tashlaymiz
                          });
                      }, 5000);

                         // Muvaffaqiyatli javob
                    },
                    error: function (xhr, status, error) {
                        alert("Xatolik yuz berdi: " + error);
                        setTimeout(function () {
                        $('#response_form').fadeOut('slow', function () {
                            $(this).empty().show(); // Divni tozalab, yana koâ€˜rinadigan qilamiz
                        });
                        
                    }, 5000);
                    }
                });
            });
        });
    </script>
    
    <script>
      console.log("WebSocket boshlanmoqda:", window.location.host);
      const socket = new WebSocket("ws://" + window.location.host + "/ws/task-updates/");
  
      document.addEventListener("DOMContentLoaded", function () {
          socket.onmessage = function (event) {
              const data = JSON.parse(event.data);
              console.log("WebSocket ma'lumot oldi:", data.new_task);
  
              // Ma'lumotni qo'shish uchun elementni olish
              const taskTitleElement = document.getElementById("task_title");
              const task_queueElement = document.getElementById("task_queue");
              
              if (!taskTitleElement) {
                  console.error("Xatolik: #task_title elementi topilmadi!");
                  return;
              }
              if (!task_queueElement) {
                  console.error("Xatolik: #task_queue elementi topilmadi!");
                  return;
              }
  
              // Agar `service` mavjud bo'lsa, qo'shib qo'yamiz
              
              if (data.service) {
                  taskTitleElement.innerHTML +=data.service;
              }
              if (data.id) {
              
                if (data.service[0]=="ðŸ“‹"){
                  task_queueElement.innerHTML +=data.service[2]+data.id;
                }
                else{
                  taskTitleElement.innerHTML +=data.service[0]+data.id;
                }
                  

              }
              
              // Agar `message` mavjud bo'lsa, ekranga chiqaramiz
              if (data.message) {
                task_queueElement.innerText = data.message;
              }
              if(data.new_task==null){
                taskTitleElement.innerHTML =''
              }
              // Agar yangi vazifa mavjud bo'lsa, ekranga chiqaramiz
              if (data.new_task) {
                  taskTitleElement.innerText = data.new_task.service;
                  // console.log(data.new_task.service)
                  if (/^[A-Za-z]$/.test(data.new_task.service[0])){
                    task_queueElement.innerText=data.new_task.service[0]+data.new_task.id;
                  }
                  else{
                    // console.log(data.new_task.service[2])
                    task_queueElement.innerText=data.new_task.service[2]+data.new_task.id;

                  }

                  
              }
              
          };
      });
  </script>
  
  
  
  

  
{%endblock%}